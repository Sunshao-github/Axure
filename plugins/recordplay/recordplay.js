!function(){if($axure.document.configuration.showRecordPlay){$(window.document).ready(function(){$axure.player.createPluginHost({id:"recordPlayHost",context:"interface",title:"Recording"}),x(),$("#recordButton").click(f),$("#playButton").click(m),$("#stopButton").click(p),$("#deleteButton").click(I),$axure.page.bind("load.page_notes",function(){$.ajax({type:"POST",url:"/RecordController/ListRecordings",success:function(r){for(var i in $("#recordNameHeader").html(""),$("#recordPlayContent").html(""),e=[],n||(t=0,n=[],o=0,a="",s={}),r.recordingList)l(r.recordingList[i]);return!1}})})});var e,n,t,o,r,i,a,s,c=new RegExp("^axRecording[0-9]{4}$","i"),d=new RegExp("[0-9]{4}$","i"),l=function(n){$.ajax({type:"POST",url:"/RecordController/GetRecording",data:{recordingId:n.recordingId},success:function(n){e[e.length]=function(e){if(c.exec(e.recordingName)){var n=d.exec(e.recordingName),o=parseInt(n);t<o&&(t=o)}for(var r in e.eventList){var i=e.eventList[r];i.eventInfo={},i.eventInfo.srcElement=i.elementID,v(i.eventType)&&(i.eventInfo.mousePositions=[],i.eventInfo.mousePositions=i.mousePositions,i.timeStamp=i.mousePositions[0].timeStamp),g(i.eventType)&&(i.eventInfo.cursor={},i.eventInfo.cursor=i.cursor),"OnDrag"===i.eventType&&(i.eventInfo.dragInfo={},i.eventInfo.dragInfo=i.dragInfo,i.timeStamp=i.dragInfo.startTime)}return e}(n),$("#recordingContainer").find("li").filter(".recordingRootNode").append(S(n)),P(n)}})},u=function(){return"axRecording"+(n=function(e,t){return t>0?n("0"+e,t-1):e},n(e=t,4-String(e).length));var e,n},g=function(e){return"OnClick"===e||"OnMouseUp"===e||"OnMouseDown"===e||"OnMouseOver"===e||"OnKeyUp"===e||"OnSelectedChange"===e||"OnSelect"===e||"OnUnselect"===e||"OnTextChange"===e||"OnMouseOut"===e},v=function(e){return"OnMouseHover"===e||"OnMouseMove"===e};$axure.messageCenter.addMessageListener(function(e,t){var o,r;if("logEvent"===e){if(a!==t.elementID&&(s={},a=t.elementID),v(t.eventType))(o=s[t.eventType])?(r=o.eventInfo.mousePositions)[r.length]={cursor:t.eventInfo.cursor,timeStamp:t.timeStamp}:(t.eventInfo.mousePositions=[],t.eventInfo.mousePositions[0]={cursor:t.eventInfo.cursor,timeStamp:t.timeStamp},n[n.length]=t,s[t.eventType]=t);else;g(t.eventType)&&(n[n.length]=t,s={},a=t.elementID),"OnDrag"===t.eventType&&((o=s[t.eventType])?(r=o.eventInfo.mousePositions)[r.length]={dragInfo:t.eventInfo.dragInfo,timeStamp:t.timeStamp}:(t.eventInfo.mousePositions=[],t.eventInfo.mousePositions[0]={dragInfo:t.eventInfo.dragInfo,timeStamp:t.timeStamp},n[n.length]=t,s[t.eventType]=t))}});var f=function(e){$("#recordButton").addClass("recordPlayButtonSelected"),t++,o=(new Date).getTime(),$.ajax({type:"POST",url:"/RecordController/CreateRecording",data:{recordingName:u(),timeStamp:o},success:function(e){r=e.recordingId,i=e.recordingName,$axure.messageCenter.postMessage("startRecording",{recordingId:r,recordingName:i})}})},m=function(e){$("#playButton").addClass("recordPlayButtonSelected")},p=function(t){var a,c;if($("#sitemapLinksContainer").toggle(),$("#recordButton").is(".recordPlayButtonSelected")){$("#recordButton").removeClass("recordPlayButtonSelected"),a={recordingId:r,recordingName:i,eventList:n},e[e.length]=a,$("#recordingContainer").find("li").filter(".recordingRootNode").append(S(a)),P(a),s={};var d=[];for(var l in n){var u=n[l];if("OnDrag"===u.eventType){var f=u.eventInfo.mousePositions[u.eventInfo.mousePositions.length-1].dragInfo;u.eventInfo.dragInfo.currentX=f.currentX,u.eventInfo.dragInfo.currentY=f.currentY,u.eventInfo.dragInfo.currentTime=f.currentTime,u.eventInfo.dragInfo.xDelta=u.eventInfo.dragInfo.currentX-u.eventInfo.dragInfo.lastX,u.eventInfo.dragInfo.yDelta=u.eventInfo.dragInfo.currentY-u.eventInfo.dragInfo.lastY,c=y(c={},u,["eventType","elementID","path"]),(c=y(c,u.eventInfo,["dragInfo"])).recordingId=r}g(u.eventType)&&(c=y(c={},u,["timeStamp","eventType","elementID","path"]),(c=y(c,u.eventInfo,["cursor"])).recordingId=r),v(u.eventType)&&(c=y(c={},u,["eventType","elementID","path"]),(c=y(c,u.eventInfo,["mousePositions"])).recordingId=r),d[d.length]=c}n=[],$axure.messageCenter.postMessage("stopRecording",undefined);var m={recordingName:i,recordingId:r,recordingStart:(new Date).getTime(),recordingEnd:o,eventList:d};$.ajax({type:"POST",url:"/RecordController/StopRecording",data:{jsonText:JSON.stringify(m)}})}$("#playButton").is(".recordPlayButtonSelected")&&$("#playButton").removeClass("recordPlayButtonSelected")},I=function(e){$.ajax({type:"POST",url:"/RecordController/DeleteRecordings",success:function(e){}})},y=function(e,n,t){for(var o in t)e[t[o]]=n[t[o]];return e},P=function(e){for(var n in e.eventList){var t=e.eventList[n],o=e.recordingId+"_"+t.timeStamp;$("#"+o).click(T(e.recordingId,t.timeStamp))}},S=function(e){var n,t,o='<ul class="recordingTree">';for(r in o+="<li class='recordingNode recordingExpandableNode'>",o+='<div class="recordingContainer" style="margin-left:15px">',o+='<a class="recordingPlusMinusLink"><span class="recordingMinus"></span></a>',o+='<a class="recordingPageLink" nodeurl="home.html">',o+='<span class="recordingPageIcon"></span>',o+='<span class="recordingPageName">'+e.recordingName+"</span>",o+="</a>",o+="<ul>",e.eventList){n=e.eventList[r],o+='<li class="recordingNode recordingLeafNode">',o+='<div class="recordingEventContainer" style="margin-left:44px">';var r=e.recordingId+"_"+n.timeStamp;for(t in o+='<a id="'+r+'" class="sitemapPageLink">',o+="Event ID: "+r+"<br/>",o+='<span class="sitemapPageIcon"></span>',o+='<span class="sitemapPageName">',o+="elementID: "+n.elementID+"<br/>",o+="eventType: "+n.eventType+"<br/>",n.path)o+="/"+n.path[t];o+="<br/>",o+="</span>",o+="</a>",o+="</div>",o+="</li>"}return o+="</ul>",o+="</div>",o+="</li>",o+="</ul>"},T=function(n,t){for(var o in e)if(e[o].recordingId===n)for(var r in e[o].eventList)if(e[o].eventList[r].timeStamp===t){var i,a,s=e[o].eventList[r];"onclick"===(a=s.eventType.toLowerCase())||"onmousein"===a?(i=y(i={},s.eventInfo,["cursor","timeStamp","srcElement"]),s.eventInfo.inputType&&(i=y(i,s.eventInfo,["inputType","inputValue"]))):i=s.eventInfo;var c={element:s.elementID,eventInfo:i,eventType:s.eventType};return function(){$axure.messageCenter.postMessage("playEvent",c)}}},x=function(){$("#recordPlayHost").html("<div id='recordPlayContainer'><div id='recordPlayToolbar'><div style='height:30px;'><a id='recordButton' title='Start a Recording' class='recordPlayButton'></a><a id='playButton' title='Play Back a Recording' class='recordPlayButton'></a><a id='stopButton' title='Stop' class='recordPlayButton'></a><a id='deleteButton' title='Delete All Recordings' class='recordPlayButton'></a></div><div id='recordingContainer'><li class='recordingNode recordingRootNode'></li></div></div>")}}}();